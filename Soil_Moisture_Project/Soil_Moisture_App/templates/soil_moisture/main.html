<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>User Dashboard</title>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
    

  {% load static %}
  <link rel="stylesheet" href="{% static 'soil_moisture/css/main.css' %}">
  <script src="{% static 'soil_moisture/js/linegraph.js' %}"></script>
</head>
<body>

<!-- Section 1: Header-->
 <div class="head">
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <span><i class='bx bx-leaf'></i></span>
      <a href="#">SoilSense AI</a>
    </div>
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">About</a></li>
      <li><a href="#">Historical Data</a></li>
      <li><a href="#">Predictions</a></li>
      <li><a href="#">Reports</a></li>
    </ul>
    <div class="dropdown">
      <img src="{% static 'soil_moisture/images/admin.jpg' %}" alt="User Avatar" class="user-avatar">
      <a class="btn btn-outline-success" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span class="mr-3">{{ request.user }}</span>
      </a>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuLink">
        <a class="dropdown-item" href="#"><i class='bx bx-user icon'></i> Profile</a>
        <a class="dropdown-item" href="{% url 'logout' %}"><i class='bx bx-log-out icon'></i> Logout</a>
      </div>
    </div>
  </header>

  <!-- Main Body -->
 <div class="main-body">
  <h2>Dashboard</h2>
  <div class="promo_card">
    <h1>Welcome to MoistureMonitor AI</h1>
    <span>Optimize irrigation, reduce water waste, and improve crop yields.</span>
    <button>Learn More</button>
  </div>
  <div class="did-you-know">
    <h2>Did You Know?</h2>
    <a class="dropdown-item" href="{% url 'logout' %}"></i> Logout</a>
    <ul>
        <li>Soil moisture levels can vary significantly based on soil texture, weather conditions, and plant type.</li>
        <li>Efficient irrigation practices can save up to 50% of water compared to traditional methods.</li>
        <li>Advanced soil moisture sensors and data analytics can provide real-time insights for precise irrigation management.</li>
    </ul>
  </div>

 </div>
</div>
 
 
<!-- Section 3: Graphs -->
  <div class="graphs">
    <div class="section-heading">
      <div class="line-dec"></div>
      <h2>Browse Through <em>Fields</em> Here.</h2>
  </div>
    <!-- Cards displaying average soil moisture and rainfall per location -->
    <div class="container">
      <div class="row">
          {% for item in location_data %}
          <div class="col-md-4">
              <div class="card" style="width: 100%;">
                  <div class="card-body"> 
                      <h5 class="card-title"><span><i class='bx bx-bar-chart-square'></i></span>{{ item.location }}</h5>
                      <p class="card-text"><strong>Average Moisture:</strong> {{ item.avg_moisture }}</p>
                      <p class="card-text"><strong>Average Rainfall:</strong> {{ item.avg_rainfall }}</p>
                      <a href="#">Details</a>
                  </div>
              </div>
          </div>
          {% endfor %}
      </div>
    </div>

 

    <!-- Charts -->
    <div class="section-heading">
      <div class="line-dec"></div>
      <h2>View <em>Charts</em> Here.</h2>
    </div>
    <div class="my-4">
      <div class="row">
        <div class="col-md-6">
          <h3>Humidity vs Temperature</h3>
          <canvas id="HumidityTemperatureChart" style="width: 80%; margin: auto; background-color: aliceblue;"></canvas>
        </div>
        <div class="col-md-6">
          <h3>Rainfall received in each location</h3>
          <canvas id="rainfallChart" style="width: 60%; margin: auto;"></canvas>
        </div>
      </div>
    </div>
 

  <!-- Historical data -->
  <div class="section-heading">
    <div class="line-dec"></div>
    <h2>View <em>Historical Data</em> Here.</h2>
  </div>

  <main class="table">
    <section class="table__header">
      <h1>Historical Data</h1>
    </section>
    <section class="table__body">
      <table>
        <thead>
          <tr>
            <th># <span class="icon-arrow">&UpArrow;</span></th>
            <th>Date <span class="icon-arrow">&UpArrow;</span></th>
            <th>Time <span class="icon-arrow">&UpArrow;</span></th>
            <th>Location <span class="icon-arrow">&UpArrow;</span></th>
            <th>Temperature (°C) <span class="icon-arrow">&UpArrow;</span></th>
            <th>Humidity (%) <span class="icon-arrow">&UpArrow;</span></th>
            <th>Soil Texture <span class="icon-arrow">&UpArrow;</span></th>
            <th>Soil Moisture (%) <span class="icon-arrow">&UpArrow;</span></th>
          </tr>
        </thead>
        <tbody>
          {% if history %}
            {% for data in history %}
              <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ data.date }}</td>
                <td>{{ data.time }}</td>
                <td>{{ data.location }}</td>
                <td>{{ data.temperature }}</td>
                <td>{{ data.humidity }}</td>
                <td>{{ data.soil_texture }}</td>
                <td>{{ data.soil_moisture }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="8">No data available</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </section>
  </main>

 </div>

 
<!-- Section 4: Footer -->
 
   <!-- Footer -->
   <footer>
    <div class="footer-container">
        <div class="footer-left">
            <h3>Soil Moisture Web App</h3>
            <p>&copy; 2024 Soil Moisture Web App. All rights reserved.</p>
        </div>
        <div class="footer-middle">
            <h4>Quick Links</h4>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">Reports</a></li>
                <li><a href="#">Contact Us</a></li>
            </ul>
        </div>
        <div class="footer-right">
            <h4>Contact Us</h4>
            <p>Email: info@soilmoistureapp.com</p>
            <p>Phone: +256 456 7890</p>
            <p>Address: 1234 Street A, City, Country</p>
        </div>
    </div>
</footer>




 <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

   
  <!-- JavaScript -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script>
    function createScatterChart(ctx, labels, datasets) {
      new Chart(ctx, {
        type: 'scatter',
        data: {
          labels: labels,
          datasets: datasets
        },
        options: {
          scales: {
            x: {
              type: 'linear',
              title: {
                display: true,
                text: 'Temperature'
              },
              ticks: {
                callback: function(value) {
                  return value + '°C'; // Add °C to temperature labels
                }
              }
            },
            y: {
              title: {
                display: true,
                text: 'Humidity'
              },
              ticks: {
                callback: function(value) {
                  return value + '%'; // Add % to humidity labels
                }
              }
            }
          }
        }
      });
    }
  
    document.addEventListener('DOMContentLoaded', function () {
      var moistureData = [
        {% for entry in data %}
        {
          date: '{{ entry.date|date:"Y-m-d" }}',
          time: '{{ entry.time }}',
          soil_moisture: {{ entry.soil_moisture }},
          temperature: {{ entry.temperature }},
          humidity: {{ entry.humidity }},
          rainfall: {{ entry.rainfall }}
        },
        {% endfor %}
      ];
  
      var temperatureData = moistureData.map(function(entry) {
        return entry.temperature; // Temperature for x-axis data
      });
  
      var humidityData = moistureData.map(function(entry) {
        return entry.humidity; // Humidity for y-axis data
      });
  
      var scatterCtx = document.getElementById('HumidityTemperatureChart').getContext('2d');
      createScatterChart(scatterCtx, temperatureData, [{
        label: 'Humidity vs Temperature',
        data: moistureData.map(function(entry) {
          return {
            x: entry.temperature,
            y: entry.humidity
          };
        }),
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
      }]);
  
      // Draw a pie chart showing the average rainfall received in each location
      var rainfallCtx = document.getElementById('rainfallChart').getContext('2d');
      var rainfallLabels = [];
      var rainfallData = [];
  
      {% for area in average_rainfall_per_area %}
        rainfallLabels.push("{{ area.location }}");
        rainfallData.push({{ area.avg_rainfall }});
      {% endfor %}
  
      var pieChartData = {
        labels: rainfallLabels,
        datasets: [{
          data: rainfallData,
          backgroundColor: [
            'rgba(255, 99, 132, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
            'rgba(255, 106, 64, 0.2)'
          ],
          borderColor: [
            'rgba(255, 99, 132, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
            'rgba(255, 159, 64, 1)'
          ],
          borderWidth: 1
        }]
      };
  
      new Chart(rainfallCtx, {
        type: 'pie',
        data: pieChartData,
        options: {
          responsive: true,
          maintainAspectRatio: true
        }
      });
    });
  </script>
  
</body>
</html>